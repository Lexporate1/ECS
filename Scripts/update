#!/bin/bash -e
echo $0
source "$(cd $(dirname ${BASH_SOURCE[0]}) && pwd)/consts"

$SCRIPTS/pull
$SCRIPTS/test
$SCRIPTS/build

# clean
rm -rf $BUILD

# create folder structure
mkdir $BUILD $BUILD_SRC $BUILD_DOCS $BUILD_DEPLOY

# Blueprints
cp_dll "$ADDONS/$DNS.Blueprints" $BUILD_SRC
cp_dll "$ADDONS/$DNS.Blueprints.CodeGeneration.Plugins" $BUILD_SRC
cp_dll "$ADDONS/$DNS.Blueprints.Unity" $BUILD_SRC
cp_dll "$ADDONS/$DNS.Blueprints.Unity.Editor" $BUILD_SRC

# CodeGeneration
cp_dll "$ADDONS/$DNS.CodeGeneration.Attributes" $BUILD_SRC
cp_dll "$ADDONS/$DNS.CodeGeneration.Plugins" $BUILD_SRC

# Migration
cp_dll "$ADDONS/$DNS.Migration" $BUILD_SRC
cp_exe "$ADDONS/$DNS.Migration.CLI" $BUILD_SRC
cp_dll "$ADDONS/$DNS.Migration.Unity.Editor" $BUILD_SRC

# Unity
cp_dll "$ADDONS/$DNS.Unity" $BUILD_SRC
cp_dll "$ADDONS/$DNS.Unity.Editor" $BUILD_SRC

# VisualDebugging
cp_dll "$ADDONS/$DNS.VisualDebugging.CodeGeneration.Plugins" $BUILD_SRC
cp_dll "$ADDONS/$DNS.VisualDebugging.Unity" $BUILD_SRC
cp_dll "$ADDONS/$DNS.VisualDebugging.Unity.Editor" $BUILD_SRC

# Entitas
cp_dll $DNS $BUILD_SRC


# update unity project

DDD="$ROOT/Libraries/DesperateDevs"

# Blueprints
libDir="$ADDONS_TEST/Blueprints/Assets/Libraries"
editorLibDir="$libDir/Editor"
rm -rf $libDir
mkdir $libDir $editorLibDir
cp_dll "$DNS.Blueprints.Unity.Editor" $editorLibDir
# --- project dependencies
cp_dll $DNS $libDir
cp_dll "$DNS.Blueprints" $libDir
cp_dll "$DNS.Blueprints.Unity" $libDir
cp_dll "$DNS.Unity.Editor" $editorLibDir
cp_dll "$DNS.VisualDebugging.Unity.Editor" $editorLibDir
# --- desperate devs dependencies
cp "$DDD.Unity.Editor" $editorLibDir
cp "$DDD.Utils" $libDir


# Entitas.Unity
libDir="$ADDONS_TEST/Entitas.Unity/Assets/Libraries"
editorLibDir="$libDir/Editor"
rm -rf $libDir
mkdir $libDir $editorLibDir
cp_dll "$DNS.Unity.Editor" $editorLibDir
# --- project dependencies
cp_dll $DNS $libDir
# --- desperate devs dependencies
cp "$DDD.Serialization" $libDir
cp "$DDD.Unity.Editor" $editorLibDir

# Migration
libDir="$ADDONS_TEST/Migration/Assets/Libraries"
editorLibDir="$libDir/Editor"
rm -rf $libDir
mkdir $libDir $editorLibDir
cp_dll "$DNS.Migration.Unity.Editor" $editorLibDir
# --- project dependencies
cp_dll "$DNS.Migration" $libDir
cp_dll "$DNS.Unity.Editor" $editorLibDir
# --- desperate devs dependencies
cp "$DDD.Unity.Editor" $editorLibDir
cp "$DDD.Utils" $libDir

# VisualDebugging
libDir="$ADDONS_TEST/VisualDebugging/Assets/Libraries"
editorLibDir="$libDir/Editor"
rm -rf $libDir
mkdir $libDir $editorLibDir
cp_dll "$DNS.VisualDebugging.Unity.Editor" $editorLibDir
# --- project dependencies
cp_dll $DNS $libDir
cp_dll "$DNS.CodeGeneration.Plugins" $editorLibDir
cp_dll "$DNS.Unity" $libDir
cp_dll "$DNS.VisualDebugging.Unity" $libDir
# --- desperate devs dependencies
cp "$DDD.CodeGeneration.CodeGenerator" $editorLibDir
cp "$DDD.Serialization" $libDir
cp "$DDD.Unity.Editor" $editorLibDir
cp "$DDD.Utils" $libDir
